{% extends "admin/base_admin.html" %}

{% block subtitle %}Gerenciamento de Casas{% endblock %}

{% block content %}
<div class="admin-actions">
    <div class="search-container">
        <form method="GET" action="{% url 'admin_casas' %}">
            <input type="text" name="search" placeholder="Buscar por título, endereço ou proprietário..." value="{{ request.GET.search }}">
            <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
        </form>
    </div>
</div>

<div class="table-container">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Imagem</th>
                <th>Título</th>
                <th>Proprietário</th>
                <th>Endereço</th>
                <th>Tipo</th>
                <th>Preço (Mês)</th>
                <th>Capacidade</th>
                <th>Data de Cadastro</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for casa in casas %}
            <tr>
                <td>
                    {% if casa.imagem_principal %}
                    <img src="{{ casa.imagem_principal.url }}" alt="{{ casa.titulo }}" class="casa-thumbnail">
                    {% else %}
                    <div class="no-image">Sem imagem</div>
                    {% endif %}
                </td>
                <td>{{ casa.titulo }}</td>
                <td>{{ casa.owner.first_name }} {{ casa.owner.last_name }}</td>
                <td>{{ casa.endereco }}</td>
                <td>{{ casa.tipo }}</td>
                <td>R$ {{ casa.preco_mes }}</td>
                <td>{{ casa.capacidade_máxima }} pessoas</td>
                <td>{{ casa.data_cadastro|date:"d/m/Y" }}</td>
                <td>
                    <a href="{% url 'admin_casa_detalhes' casa.id %}" class="btn-view">Ver</a>
                    <a href="{% url 'admin_casa_editar' casa.id %}" class="btn-edit">Editar</a>
                    <a href="{% url 'admin_casa_excluir' casa.id %}" class="btn-delete" onclick="return confirm('Tem certeza que deseja excluir esta casa?')">Excluir</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9">Nenhuma casa encontrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="pagination">
    <span class="step-links">
        {% if casas.has_previous %}
            <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">&laquo; primeira</a>
            <a href="?page={{ casas.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">anterior</a>
        {% endif %}

        <span class="current">
            Página {{ casas.number }} de {{ casas.paginator.num_pages }}
        </span>

        {% if casas.has_next %}